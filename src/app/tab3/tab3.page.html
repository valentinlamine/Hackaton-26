<ion-header [translucent]="true" class="main-header">
  <ion-toolbar>
    <ion-title>Photos aimées</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleSelectionMode()" class="header-btn" [color]="selectionMode ? 'danger' : 'primary'">
        <ion-icon [name]="selectionMode ? 'checkmark' : 'menu'" size="large"></ion-icon>
      </ion-button>
      <ion-button color="danger" [disabled]="!selectionMode || !getSelectedCount()" (click)="deleteSelected()" class="header-btn">
        <ion-icon name="trash" size="large"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <ion-grid *ngIf="likedPhotos.length; else emptyState">
    <ion-row>
      <ion-col size="6" *ngFor="let photo of likedPhotos; index as position" 
               (click)="selectionMode ? toggleSelect(photo.filepath) : openViewer(position)"
               (longpress)="!selectionMode && enterSelectionMode(photo.filepath)">
        <div class="photo-tile">
          <ion-img [src]="photo.webviewPath" [class.dimmed]="selectionMode && !selectedFilepaths.has(photo.filepath)"></ion-img>
          <ion-checkbox *ngIf="selectionMode" style="position: absolute; top: 8px; right: 8px;"
            [checked]="selectedFilepaths.has(photo.filepath)"></ion-checkbox>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ng-template #emptyState>
    <div style="padding: 16px; text-align: center; opacity: 0.7;">Aucune photo aimée pour le moment</div>
  </ng-template>

  <!-- Photo viewer component -->
  <app-photo-viewer
    [isOpen]="viewerOpen"
    [photos]="likedPhotos"
    [currentIndex]="currentIndex"
    [viewerControlsVisible]="viewerControlsVisible"
    [swipeOffset]="swipeOffset"
    [swipeTransition]="swipeTransition"
    [metadataVisible]="metadataVisible"
    [metadataOffset]="metadataOffset"
    [metadataTransition]="metadataTransition"
    [likedFilepaths]="photoService.getLikedFilepaths()"
    (close)="closeViewer()"
    (nextPhoto)="nextPhoto()"
    (prevPhoto)="prevPhoto()"
    (toggleLike)="toggleLike($event)"
    (deleteCurrent)="deleteCurrentPhoto()"
    (viewerClick)="onViewerClick($event)"
    (touchStart)="onTouchStart($event)"
    (touchMove)="onTouchMove($event)"
    (touchEnd)="onTouchEnd($event)"
    (metadataTouchStart)="onMetadataTouchStart($event)"
    (metadataTouchMove)="onMetadataTouchMove($event)"
    (metadataTouchEnd)="onMetadataTouchEnd($event)">
  </app-photo-viewer>

</ion-content>
